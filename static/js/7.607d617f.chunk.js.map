{"version":3,"sources":["pages/album/index.module.less","utils/tool.ts","pages/album/index.tsx"],"names":["module","exports","arraySplit","arr","step","len","length","rec","i","push","slice","Album","props","dispatch","useDispatch","useState","match","params","id","loading","setLoading","album","useSelector","state","getAlbumInfo","useCallback","a","getAlbumDetail","data","playlist","info","albumId","name","nickname","creator","coverImgUrl","description","tags","trackIds","setInfo","getAlbumList","formatIds","map","t","join","requests","ids","getSongList","Promise","all","result","songs","privileges","forEach","concat","list","seconds","dt","authors","ar","j","al","picUrl","getSongsUrl","cacheData","localStorage","getItem","JSON","parse","request","getSongUrl","newData","index","canPlaying","url","filter","setItem","stringify","setList","setSongList","playSong","playById","useEffect","className","styles","head","logo","img","src","alt","main","color","tag","key","descript","listBox","title","size","dataSource","renderItem","item","Item","songName","songCreator","second","Duration","onClick","type","disabled","visibilityHeight"],"mappings":"uFACAA,EAAOC,QAAU,CAAC,MAAQ,0BAA0B,KAAO,0BAA0B,KAAO,0BAA0B,IAAM,wBAAwB,KAAO,0BAA0B,KAAO,0BAA0B,SAAW,0BAA0B,KAAO,0BAA0B,QAAU,0BAA0B,MAAQ,0BAA0B,KAAO,0BAA0B,MAAQ,0BAA0B,SAAW,0BAA0B,YAAc,0BAA0B,OAAS,0BAA0B,WAAa,4B,iKCgB3hB,IAAMC,EAAa,SAACC,GAAyB,IAAfC,EAAc,uDAAP,GACpCC,EAAMF,EAAIG,OACVC,EAAM,GACZ,GAAIF,GAAOD,EACT,MAAO,CAACD,GAEV,IAAK,IAAIK,EAAI,EAAGA,EAAIH,EAAKG,GAAKJ,EAC5BG,EAAIE,KAAKN,EAAIO,MAAMF,EAAGA,EAAIJ,IAE5B,OAAOG,G,kCC8IMI,UA5JD,SAACC,GACb,IAAMC,EAAWC,cADW,EAEfC,mBAASH,EAAMI,MAAMC,OAAOC,IAAlCA,EAFqB,sBAGEH,oBAAS,GAHX,mBAGrBI,EAHqB,KAGZC,EAHY,KAItBC,EAAQC,aAAY,SAACC,GAAD,OAAsBA,EAAMF,SAEhDG,EAAeC,sBAAW,uCAAC,WAAMP,GAAN,qBAAAQ,EAAA,sEACRC,YAAeT,GADP,gBACvBU,EADuB,EACvBA,KACAC,EAAaD,EAAbC,SACFC,EAAc,CAClBC,QAASF,EAASX,GAClBc,KAAMH,EAASG,KACfC,SAAUJ,EAASK,QAAQD,SAC3BE,YAAaN,EAASM,YACtBC,YAAaP,EAASO,YACtBC,KAAMR,EAASQ,KACfC,SAAUT,EAASS,UAErBzB,EACE0B,YAAQ,CACNX,KAAME,KAGVU,EAAaV,EAAKQ,UAjBa,2CAAD,sDAkB7B,IAGGE,EAAef,sBAAW,uCAAC,WAAMa,GAAN,yBAAAZ,EAAA,6DACzBe,EAAYvC,EAAWoC,EAASI,KAAI,SAACC,GAAD,OAAuBA,EAAEzB,OAAKwB,KAAI,SAAAC,GAAC,OAAIA,EAAEC,KAAK,QAClFC,EAAWJ,EAAUC,KAAI,SAAAI,GAAG,OAAIC,YAAYD,MAFnB,SAIVE,QAAQC,IAAIJ,GAJF,OAIzBK,EAJyB,OAM3BC,EAAe,GACfC,EAAoB,GAExBF,EAAOG,SAAQ,SAAAV,GACbQ,EAAQA,EAAMG,OAAOX,EAAEf,KAAKuB,OAC5BC,EAAaA,EAAWE,OAAOX,EAAEf,KAAKwB,eAGlCG,EAAgBJ,EAAMT,KAAI,SAACC,EAAGnC,GAAJ,MAAW,CACzCU,GAAIkC,EAAW5C,GAAGU,GAClBc,KAAMW,EAAEX,KACRwB,QAASb,EAAEc,GAAK,IAChBC,QAASf,EAAEgB,GAAGjB,KAAI,SAACkB,GAAD,OAAyBA,EAAE5B,QAAMY,KAAK,UACxDT,YAAaQ,EAAEkB,GAAGC,WAGpBC,EAAYR,GAEZnC,GAAW,GAxBoB,4CAAD,sDAyB7B,IAEG2C,EAActC,sBAAW,uCAAC,WAAO8B,GAAP,uBAAA7B,EAAA,yDAE1BE,EAAgB,KACdoC,EAAYC,aAAaC,QAAQhD,IAAO,MAHhB,gBAK5BU,EAAOuC,KAAKC,MAAMJ,GALU,8BAOtBK,EAAUd,EAAKb,KAAI,SAAAC,GAAC,OAAI2B,YAAW3B,EAAEzB,OAPf,SAQP8B,QAAQC,IAAIoB,GARL,OAQtBnB,EARsB,OAStBqB,EAAUhB,EAAKb,KAAI,SAACC,EAAG6B,GAAJ,mBAAC,eACrB7B,GADoB,IAEvB8B,aAAcvB,EAAOsB,GAAO5C,KAAKA,KAAK,GAAG8C,IACzCA,IAAKxB,EAAOsB,GAAO5C,KAAKA,KAAK,GAAG8C,SAElC9C,EAAO2C,EAAQI,QAAO,SAAAhC,GAAC,OAAIA,EAAE8B,cAC7BR,aAAaW,QAAQ1D,EAAIiD,KAAKU,UAAUjD,IACxCf,EACEiE,YAAQ,CACNlD,KAAM2C,KAlBkB,QAuB9B1D,EACEkE,YAAY,CACVnD,UAzB0B,4CAAD,sDA4B5B,IAEGoD,EAAWvD,uBAAY,SAAAP,GAC3BL,EAASoE,YAAS,CAAE/D,UACnB,IAKH,OAHAgE,qBAAU,WACR1D,EAAaN,KACZ,CAACA,IAEF,yBAAKiE,UAAWC,IAAO/D,OACrB,yBAAK8D,UAAWC,IAAOC,MACrB,yBAAKF,UAAWC,IAAOE,MACrB,yBAAKH,UAAWC,IAAOG,IAAKC,IAAKnE,EAAMS,KAAKK,YAAasD,IAAI,MAE/D,yBAAKN,UAAWC,IAAOM,MACrB,yBAAKP,UAAWC,IAAOpD,MACrB,kBAAC,IAAD,CAAK2D,MAAM,WAAX,gBACCtE,EAAMS,KAAKE,MAEd,yBAAKmD,UAAWC,IAAOnD,UAAvB,2BAEGZ,EAAMS,KAAKG,UAEd,yBAAKkD,UAAWC,IAAO/C,MAAvB,qBAEGhB,EAAMS,KAAKO,KAAKK,KAAI,SAAAkD,GAAG,OACtB,kBAAC,IAAD,CAAKC,IAAKD,GAAMA,OAGpB,yBAAKT,UAAWC,IAAOU,UAAvB,qBAEGzE,EAAMS,KAAKM,eAIlB,yBAAK+C,UAAWC,IAAOW,SACrB,yBAAKZ,UAAWC,IAAOY,OAAvB,4BACA,kBAAC,IAAD,CACEC,KAAK,QACL9E,QAASA,EACT+E,WAAY7E,EAAMkC,KAClB4C,WAAY,SAACC,EAAM5B,GAAP,OACV,kBAAC,IAAK6B,KAAN,CAAWR,IAAKO,EAAKlF,IACnB,yBAAKiE,UAAWC,IAAOgB,MACrB,yBAAKjB,UAAWC,IAAOZ,OAAQA,EAAQ,GACvC,yBAAKW,UAAWC,IAAOM,MACrB,yBAAKP,UAAWC,IAAOkB,UAAWF,EAAKpE,MACvC,yBAAKmD,UAAWC,IAAOmB,aAAcH,EAAK1C,UAE5C,yBAAKyB,UAAWC,IAAOoB,QACrB,kBAACC,EAAA,EAAD,CAAUjD,QAAS4C,EAAK5C,WAE1B,yBAAK2B,UAAWC,IAAOX,YACpB2B,EAAK3B,WACJ,kBAAC,IAAD,CAAQiC,QAAS,kBAAM1B,EAASoB,EAAKlF,KAAKyF,KAAK,OAAOV,KAAK,SAA3D,gBAIA,kBAAC,IAAD,CAAQU,KAAK,OAAOV,KAAK,QAAQW,UAAQ,GAAzC,6BAUd,kBAAC,IAAD,CAASC,iBAAkB","file":"static/js/7.607d617f.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"album\":\"_2hzivxDtZ7Lpvgv_X6pVe_\",\"head\":\"_2G7dEGYEINlmoML5hs1NhP\",\"logo\":\"_1XpWqywhwbUYPRNTj_2SwZ\",\"img\":\"SjhxsrVLLEEskJ03LfpEl\",\"main\":\"_1-lryxsU1rMvVjdxnaLMSB\",\"name\":\"_1TgPIWbSRfEXB5K_PytIj-\",\"nickname\":\"_1jILlatWTSWRHiqXAiGlp6\",\"tags\":\"_2NXyU-l3NDvjYBWcqg7rAo\",\"listBox\":\"_380ztTIKx73V2U9a6z6OTk\",\"title\":\"_2R7Lx1geUI8ZuUW1MaR26i\",\"item\":\"_1UK-h9FidD_9NTxhMCLDzD\",\"index\":\"_3FrKiNJzzQaolrCA5-D_lD\",\"songName\":\"_2b0O4qR1U949NuqZHG0rDW\",\"songCreator\":\"_2Ekk2V7bfLi-WIEHRrawnv\",\"second\":\"_3HGrHnDeHpZumNXgIB0ahX\",\"canPlaying\":\"_3B08xlREDZ2TTBjaHLS8na\"};","/**\n * 返回当前路径中uri的指定参数\n * @param {string} name\n * @return {string|null}\n */\nexport function getUrlParam(name: string) {\n  const reg = new RegExp(`(^|&)${name}=([^&]*)(&|$)`); // 构造一个含有目标参数的正则表达式对象\n  const r = window.location.search.substr(1).match(reg); // 匹配目标参数\n  if (r != null) return decodeURIComponent(r[2]);\n  return null; // 返回参数值\n}\n\n/**\n * 数组分片，当数组长度超过step时，以step为步长分片数组\n * @param {Array} arr\n * @param {Number} step 分片步长\n */\nexport const arraySplit = (arr: any, step = 20) => {\n  const len = arr.length;\n  const rec = [];\n  if (len <= step) {\n    return [arr];\n  }\n  for (let i = 0; i < len; i += step) {\n    rec.push(arr.slice(i, i + step));\n  }\n  return rec;\n};\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { Tag, List, Button, BackTop } from 'antd';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { IInfo, IList, setInfo, setList } from '@/store/albumSlice';\nimport { getAlbumDetail, getSongList, getSongUrl } from '@/api';\nimport { arraySplit } from '@/utils/tool';\nimport Duration from '@/components/Duration';\nimport { RootState } from '@/store/rootReducer';\nimport { playById } from '@/store/playerSlice';\nimport styles from './index.module.less';\nimport { setSongList } from '@/store/playerSlice';\n\nconst Album = (props: any) => {\n  const dispatch = useDispatch();\n  const [id] = useState(props.match.params.id);\n  const [loading, setLoading] = useState(true);\n  const album = useSelector((state: RootState) => state.album);\n  // 获取歌单详情\n  const getAlbumInfo = useCallback(async id => {\n    const { data } = await getAlbumDetail(id);\n    const { playlist } = data;\n    const info: IInfo = {\n      albumId: playlist.id,\n      name: playlist.name,\n      nickname: playlist.creator.nickname,\n      coverImgUrl: playlist.coverImgUrl,\n      description: playlist.description,\n      tags: playlist.tags,\n      trackIds: playlist.trackIds,\n    };\n    dispatch(\n      setInfo({\n        data: info,\n      }),\n    );\n    getAlbumList(info.trackIds);\n  }, []);\n\n  // 获取歌曲列表\n  const getAlbumList = useCallback(async trackIds => {\n    const formatIds = arraySplit(trackIds.map((t: { id: string }) => t.id)).map(t => t.join(','));\n    const requests = formatIds.map(ids => getSongList(ids));\n\n    const result = await Promise.all(requests);\n\n    let songs: any[] = [];\n    let privileges: any[] = [];\n\n    result.forEach(t => {\n      songs = songs.concat(t.data.songs);\n      privileges = privileges.concat(t.data.privileges);\n    });\n\n    const list: IList[] = songs.map((t, i) => ({\n      id: privileges[i].id,\n      name: t.name,\n      seconds: t.dt / 1000,\n      authors: t.ar.map((j: { name: string }) => j.name).join('，'),\n      coverImgUrl: t.al.picUrl,\n    }));\n    // 后台获取歌曲url\n    getSongsUrl(list);\n    // 歌曲列表加载状态\n    setLoading(false);\n  }, []);\n\n  const getSongsUrl = useCallback(async (list: IList[]) => {\n    // 添加歌曲缓存机制,以专辑id为key\n    let data: IList[] = [];\n    const cacheData = localStorage.getItem(id) || null;\n    if (cacheData) {\n      data = JSON.parse(cacheData);\n    } else {\n      const request = list.map(t => getSongUrl(t.id));\n      const result = await Promise.all(request);\n      const newData = list.map((t, index) => ({\n        ...t,\n        canPlaying: !!result[index].data.data[0].url,\n        url: result[index].data.data[0].url,\n      }));\n      data = newData.filter(t => t.canPlaying);\n      localStorage.setItem(id, JSON.stringify(data));\n      dispatch(\n        setList({\n          data: newData,\n        }),\n      );\n    }\n    // 更新可播放歌曲列表\n    dispatch(\n      setSongList({\n        data,\n      }),\n    );\n  }, []);\n\n  const playSong = useCallback(id => {\n    dispatch(playById({ id }));\n  }, []);\n\n  useEffect(() => {\n    getAlbumInfo(id);\n  }, [id]);\n  return (\n    <div className={styles.album}>\n      <div className={styles.head}>\n        <div className={styles.logo}>\n          <img className={styles.img} src={album.info.coverImgUrl} alt=\"\" />\n        </div>\n        <div className={styles.main}>\n          <div className={styles.name}>\n            <Tag color=\"magenta\">歌单</Tag>\n            {album.info.name}\n          </div>\n          <div className={styles.nickname}>\n            创建者：\n            {album.info.nickname}\n          </div>\n          <div className={styles.tags}>\n            标签：\n            {album.info.tags.map(tag => (\n              <Tag key={tag}>{tag}</Tag>\n            ))}\n          </div>\n          <div className={styles.descript}>\n            介绍：\n            {album.info.description}\n          </div>\n        </div>\n      </div>\n      <div className={styles.listBox}>\n        <div className={styles.title}>歌曲列表</div>\n        <List\n          size=\"small\"\n          loading={loading}\n          dataSource={album.list}\n          renderItem={(item, index) => (\n            <List.Item key={item.id}>\n              <div className={styles.item}>\n                <div className={styles.index}>{index + 1}</div>\n                <div className={styles.main}>\n                  <div className={styles.songName}>{item.name}</div>\n                  <div className={styles.songCreator}>{item.authors}</div>\n                </div>\n                <div className={styles.second}>\n                  <Duration seconds={item.seconds} />\n                </div>\n                <div className={styles.canPlaying}>\n                  {item.canPlaying ? (\n                    <Button onClick={() => playSong(item.id)} type=\"text\" size=\"small\">\n                      播放\n                    </Button>\n                  ) : (\n                    <Button type=\"text\" size=\"small\" disabled>\n                      无版权\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </List.Item>\n          )}\n        />\n      </div>\n      <BackTop visibilityHeight={600} />\n    </div>\n  );\n};\n\nexport default Album;\n"],"sourceRoot":""}