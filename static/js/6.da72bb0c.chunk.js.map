{"version":3,"sources":["assets/imgs/default_image.svg","components/Category/index.module.less","components/Category/List/index.module.less","pages/home/index.module.less","components/LazyImage/index.tsx","components/Category/List/index.tsx","components/Category/index.tsx","pages/home/index.tsx"],"names":["module","exports","LazyImage","props","useState","isOnload","setOnload","useEffect","img","Image","src","onload","IMAGE_PLACHOLDER","style","width","height","alt","CheckableTag","Tag","List","className","styles","catList","map","cat","key","type","catItem","catType","typeName","catContent","list","t","name","tag","checked","selectedCat","onClick","onSelect","showCatList","setShowCatList","setCatList","getCatlistFunc","useCallback","a","getCatlist","data","categories","sub","Object","keys","forEach","push","parseInt","filter","s","category","val","catSelect","fetchData","placement","visible","title","size","content","currentCat","trigger","IconFont","homeReducer","state","action","banners","payload","albumList","totalCount","pageNo","loading","initalState","useImmerReducer","dispatch","getAlbumListFunc","params","limit","offset","getAlbumList","playlists","album","id","coverImgUrl","playCount","creator","total","onPageNoChange","pageIndex","getBanner","scm","imageUrl","console","log","home","banner","autoplay","item","albumBox","Category","to","cover","fontSize","marginRight","creatorName","nickname","pagination","defaultCurrent","current","onChange","defaultPageSize","showSizeChanger"],"mappings":"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","file":"static/js/6.da72bb0c.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/default_image.3590e8c0.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"category\":\"_3mAHRFcYGDiGQD5NjIXGPy\",\"cat\":\"_2fL91aoxtpB750p_bV8Grf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"catList\":\"mEruZ2ckuwrGDZ2MSXJCo\",\"catItem\":\"_2O84mjn8D8wOpxfnqEOtXv\",\"catType\":\"_3oAYWiiJH6phwibICqvAt3\",\"catContent\":\"gTqd4UnIQvBWXOCowsaEq\",\"tag\":\"_3DVQ_vSuNEcYjSVWusAXTj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"home\":\"_1rW0pNaf1fNsEyxJ1Mfjzu\",\"banner\":\"G4VUxEqZqIoioLbBhHmct\",\"albumBox\":\"DSzUk1jApFhiIiiziwiiJ\",\"list\":\"_1LyBgoCtD8vu00-fH7p4bX\",\"album\":\"_25TOVTjWvPZEpDlZ4Ctxbi\",\"cover\":\"_12_QnF4bHP0O3Cx_-GWY_i\",\"playCount\":\"tcVtdPf6Ib8JCZMb4hjSI\",\"creatorName\":\"CRwK1pNC0vrWnK4-lgwX5\",\"name\":\"_2M4N4JW1q7OQBBF9dnfQqx\",\"pagination\":\"_1QrPHZIz1OLO5wAAzxjVHI\"};","import React, { useState, useEffect } from 'react';\nimport IMAGE_PLACHOLDER from '@/assets/imgs/default_image.svg';\n\ninterface IProps {\n  src: string;\n  width: string;\n  height: string;\n}\n\nconst LazyImage = (props: IProps) => {\n  const [isOnload, setOnload] = useState(false);\n  useEffect(() => {\n    const img = new Image();\n    img.src = props.src;\n    img.onload = () => {\n      setOnload(true);\n    };\n  }, [props.src]);\n  return (\n    <img\n      src={isOnload ? props.src : IMAGE_PLACHOLDER}\n      style={{\n        width: props.width,\n        height: props.height,\n      }}\n      alt=\"\"\n    />\n  );\n};\n\nexport default LazyImage;\n","import React from 'react';\nimport { Tag } from 'antd';\nimport { ICat } from '@/interfaces';\nimport styles from './index.module.less';\n\ninterface Iprops {\n  catList: ICat[];\n  onSelect: Function;\n  selectedCat: string;\n}\n\nconst { CheckableTag } = Tag;\n\nconst List = (props: Iprops) => {\n  return (\n    <div className={styles.catList}>\n      {props.catList.map(cat => (\n        <div key={cat.type} className={styles.catItem}>\n          <div className={styles.catType}>{cat.typeName}</div>\n          <div className={styles.catContent}>\n            {cat.list.map((t: { name: string }) => (\n              <CheckableTag\n                key={t.name}\n                className={styles.tag}\n                checked={props.selectedCat === t.name}\n                onClick={() => props.onSelect(t.name)}\n              >\n                {t.name}\n              </CheckableTag>\n            ))}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default List;\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { Popover, Button } from 'antd';\nimport { getCatlist } from '@/api';\nimport IconFont from '@/components/IconFont';\nimport styles from './index.module.less';\nimport { ICat } from '@/interfaces';\nimport '@/css/animation.less';\nimport List from './List';\n\ninterface IProps {\n  currentCat: string;\n  catSelect: Function;\n}\n\nexport default (props: IProps): JSX.Element => {\n  const [showCatList, setShowCatList] = useState(false);\n  // 分类表\n  const [catList, setCatList] = useState<ICat[]>([]);\n  // 获取风格列表\n  const getCatlistFunc = useCallback(async () => {\n    const { data } = await getCatlist();\n    const { categories, sub } = data;\n    const list: ICat[] = [];\n    Object.keys(categories).forEach(t => {\n      list.push({\n        type: parseInt(t),\n        typeName: categories[t],\n        list: sub.filter((s: { category: number }) => s.category === parseInt(t)),\n      });\n    });\n    setCatList(list);\n  }, []);\n\n  const onSelect = useCallback(\n    val => {\n      props.catSelect(val);\n      setShowCatList(false);\n    },\n    [props],\n  );\n\n  useEffect(() => {\n    async function fetchData(): Promise<void> {\n      // 获取歌单分类\n      getCatlistFunc();\n    }\n    fetchData();\n  }, [getCatlistFunc]);\n  return (\n    <div className={styles.category}>\n      <Popover\n        placement=\"topLeft\"\n        visible={showCatList}\n        title={\n          <Button size=\"small\" onClick={() => onSelect('全部')}>\n            全部风格\n          </Button>\n        }\n        content={<List catList={catList} selectedCat={props.currentCat} onSelect={onSelect} />}\n        trigger=\"click\"\n      >\n        <Button onClick={() => setShowCatList(!showCatList)}>\n          选择风格\n          <IconFont type=\"icon-up\" />\n        </Button>\n      </Popover>\n      <div className={styles.cat}>当前风格：{props.currentCat}</div>\n    </div>\n  );\n};\n","import React, { useEffect, useCallback } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Carousel, Pagination } from 'antd';\nimport { useImmerReducer } from 'use-immer';\nimport { getAlbumList, getBanner } from '@/api';\nimport { IBanner, IAblum } from '@/interfaces';\nimport IconFont from '@/components/IconFont';\nimport LazyImage from '@/components/LazyImage';\nimport Category from '@/components/Category';\nimport '@/css/animation.less';\nimport styles from './index.module.less';\n\nconst LIMIT = 35;\n\n// userReducer 整个多个state\nfunction homeReducer(state: any, action: any) {\n  switch (action.type) {\n    case 'GET_BANNER': {\n      state.banners = action.payload;\n      return;\n    }\n    case 'GET_ALBUM_LIST': {\n      const { albumList, totalCount } = action.payload;\n      state.albumList = albumList;\n      state.totalCount = totalCount;\n      return;\n    }\n    case 'CAT_SELECT': {\n      state.pageNo = 1;\n      state.cat = action.payload;\n      return;\n    }\n    case 'PAGE_CHANGE': {\n      state.pageNo = action.payload;\n      return;\n    }\n    case 'SET_PAGE_LOADING': {\n      state.loading = action.payload;\n      return;\n    }\n    default:\n      return;\n  }\n}\n\ninterface IState {\n  banners: IBanner[];\n  pageNo: number;\n  loading: boolean;\n  totalCount: number;\n  cat: string;\n  albumList: IAblum[];\n}\n\nconst initalState: IState = {\n  banners: [],\n  pageNo: 1,\n  loading: false,\n  totalCount: 0,\n  cat: '全部',\n  albumList: [],\n};\n\nexport default (): JSX.Element => {\n  const [state, dispatch] = useImmerReducer(homeReducer, initalState);\n  const { banners, pageNo, loading, totalCount, cat, albumList } = state;\n\n  // 获取专辑列表\n  const getAlbumListFunc = useCallback(\n    async (params = { cat: cat, limit: LIMIT, offset: 0 }) => {\n      // loading开始\n      dispatch({\n        type: 'SET_PAGE_LOADING',\n        payload: true,\n      });\n      const { data } = await getAlbumList(params);\n      // 更新歌单列表\n      dispatch({\n        type: 'GET_ALBUM_LIST',\n        payload: {\n          albumList: data.playlists.map((album: IAblum) => ({\n            id: album.id,\n            coverImgUrl: album.coverImgUrl,\n            playCount: album.playCount,\n            name: album.name,\n            creator: album.creator,\n          })),\n          totalCount: data.total,\n        },\n      });\n      // loading结束\n      dispatch({\n        type: 'SET_PAGE_LOADING',\n        payload: false,\n      });\n    },\n    [cat, dispatch],\n  );\n\n  // 分页变动\n  const onPageNoChange = useCallback(\n    pageIndex => {\n      dispatch({\n        type: 'PAGE_CHANGE',\n        payload: pageIndex,\n      });\n      getAlbumListFunc({\n        cat,\n        limit: LIMIT,\n        offset: pageIndex * LIMIT,\n      });\n    },\n    [cat, dispatch, getAlbumListFunc],\n  );\n\n  // 风格切换\n  const catSelect = useCallback(\n    cat => {\n      dispatch({\n        type: 'CAT_SELECT',\n        payload: cat,\n      });\n      getAlbumListFunc({\n        cat,\n        limit: LIMIT,\n        offset: 0,\n      });\n    },\n    [dispatch, getAlbumListFunc],\n  );\n\n  useEffect(() => {\n    async function fetchData(): Promise<void> {\n      // 获取顶部轮播图\n      const { data } = await getBanner(0);\n      dispatch({\n        type: 'GET_BANNER',\n        payload: data.banners.map((t: IBanner) => ({\n          scm: t.scm,\n          imageUrl: t.imageUrl,\n        })),\n      });\n      // 初始化歌单数据\n      getAlbumListFunc();\n    }\n    fetchData();\n  }, [dispatch, getAlbumListFunc]);\n\n  console.log('loading:', loading);\n  return (\n    <div className={styles.home}>\n      <div className={styles.banner}>\n        <Carousel autoplay>\n          {(banners as IBanner[]).map(banner => (\n            <div key={banner.scm} className={styles.item}>\n              <img src={banner.imageUrl} alt=\"\" />\n            </div>\n          ))}\n        </Carousel>\n      </div>\n      <div className={styles.albumBox}>\n        <Category currentCat={cat} catSelect={catSelect} />\n        <div className={styles.list}>\n          {albumList.map(album => (\n            <Link key={album.id} className={styles.album} to={`/album/${album.id}`}>\n              <div className=\"hoverBox\">\n                <div className={styles.cover}>\n                  <LazyImage src={album.coverImgUrl} width=\"100%\" height=\"auto\" />\n                  <div className={styles.playCount}>\n                    <IconFont type=\"icon-play-count\" style={{ fontSize: 16, marginRight: 2 }} />\n                    <span>{album.playCount}</span>\n                  </div>\n                  <div className={styles.creatorName}>{album.creator.nickname}</div>\n                </div>\n                <div className={styles.name}>{album.name}</div>\n              </div>\n            </Link>\n          ))}\n        </div>\n        <Pagination\n          className={styles.pagination}\n          defaultCurrent={1}\n          current={pageNo}\n          total={totalCount}\n          onChange={onPageNoChange}\n          defaultPageSize={LIMIT}\n          showSizeChanger={false}\n        />\n      </div>\n    </div>\n  );\n};\n"],"sourceRoot":""}